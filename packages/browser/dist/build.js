#!/usr/bin/env node
/**
 * Build script to bundle browser code into a single injectable string
 * Simply concatenates JS files - no TypeScript compilation needed
 */
import { readFileSync, writeFileSync } from 'fs';
import { join, dirname } from 'path';
import { fileURLToPath } from 'url';
const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);
// Handle both running from src/ (dev) and from .build.mjs (CI)
const browserDir = __dirname.endsWith('src') ? __dirname : join(__dirname, 'src');
const locatorCode = readFileSync(join(browserDir, 'locator.js'), 'utf-8');
const actionsCode = readFileSync(join(browserDir, 'actions.js'), 'utf-8');
const domtreeCode = readFileSync(join(browserDir, 'domtree.js'), 'utf-8');
const bundle = `
(function() {
  'use strict';

  ${locatorCode}

  ${actionsCode}

  ${domtreeCode}

  // Expose functions to global scope for API calls
  window.findElement = findElement;
  window.findByRole = findByRole;
  window.findByLabel = findByLabel;
  window.findByText = findByText;
  window.findByPlaceholder = findByPlaceholder;
  window.findByTestId = findByTestId;
  window.clickElement = clickElement;
  window.fillElement = fillElement;
  window.typeElement = typeElement;
  window.selectOption = selectOption;
  window.getPageStructure = getPageStructure;
})();
`.trim();
// Write bundled JavaScript
writeFileSync(join(browserDir, 'bundle.js'), bundle);
// Export as TypeScript constant
const tsExport = `// Auto-generated by build.ts - do not edit manually
export const BROWSER_BUNDLE = ${JSON.stringify(bundle)};
`;
writeFileSync(join(browserDir, 'bundle-export.ts'), tsExport);
console.log('Browser bundle built successfully');
console.log(`Bundle size: ${bundle.length} bytes`);
//# sourceMappingURL=build.js.map